<ion-header mode="ios" [translucent]="true" class="glass-header">
  <ion-toolbar mode="ios" class="animated-toolbar">
    <!-- Animated background element -->
    <div class="header-bg-pulse"></div>

    <!-- Left side content -->
    <div slot="start" class="logo-container">
      <div class="logo-shadow-animation">
        <img src="../../assets/max.png" width="80" alt="Max Logo" class="logo-text">
        <div class="animated-shadow"></div>
      </div>
    </div>

    <!-- Right side buttons -->
    <ion-buttons slot="end" class="rich-buttons">
      <ion-button id="role-button" class="premium-badge-btn" *ngIf="currentUser" fill="clear" aria-label="Account Tier">
        <div class="badge-container">
          <!-- Premium Badge with Particle Animation -->
          <div class="account-tier-badge" [class.developer-tier]="isDevUser" [class.standard-tier]="!isDevUser">
            <div class="badge-content">
              <span class="tier-label">{{ isDevUser ? "POWER USER" : "LISTENER" }}</span>

            </div>

            <!-- Developer Badge Effects -->
            <div class="particle-field" *ngIf="isDevUser">
              <!-- <div class="particle" *ngFor="let particle of particles"></div> -->
            </div>
            <div class="badge-shine" *ngIf="isDevUser"></div>
          </div>
        </div>
      </ion-button>



      <!-- Search Button -->
      <ion-button class="btn-3d" (click)="isSearch = !isSearch" aria-label="Search">
        <div class="button-content">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <defs>
              <linearGradient id="searchGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#8A2BE2" />
                <stop offset="100%" stop-color="#4B0082" />
              </linearGradient>
              <filter id="searchGlow" x="-30%" y="-30%" width="160%" height="160%">
                <feGaussianBlur stdDeviation="2" result="blur" />
                <feComposite in="SourceGraphic" in2="blur" operator="over" />
              </filter>
            </defs>
            <circle cx="11" cy="11" r="8" fill="none" stroke="url(#searchGradient)" stroke-width="1.5" />
            <path d="M21 21l-4.35-4.35" stroke="url(#searchGradient)" stroke-width="1.5" stroke-linecap="round" />
          </svg>
          <span class="button-ripple"></span>
        </div>
      </ion-button>

      <!-- Liked Songs Button -->
      <ion-button class="btn-3d heart-beat" (click)="isLikedSongsModal = true; init();" aria-label="Liked songs">
        <div class="button-content">
          <svg class="heart-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <defs>
              <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#FF2400" />
                <stop offset="100%" stop-color="#E81D1D" />
              </linearGradient>
            </defs>
            <path fill="url(#heartGradient)"
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
          </svg>
          <span class="button-ripple"></span>
        </div>
      </ion-button>

      <!-- Settings Button -->
      <ion-button class="btn-3d rotate-on-hover" (click)="isSettings = true" aria-label="Settings">
        <div class="button-content">
          <svg class="gear-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <defs>
              <linearGradient id="gearGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#00B4DB" />
                <stop offset="100%" stop-color="#0083B0" />
              </linearGradient>
            </defs>
            <path fill="none" stroke="url(#gearGradient)" stroke-width="1.5" stroke-linecap="round"
              stroke-linejoin="round" d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
            <path fill="none" stroke="url(#gearGradient)" stroke-width="1.5" stroke-linecap="round"
              stroke-linejoin="round"
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
          </svg>
          <span class="button-ripple"></span>
        </div>
      </ion-button>

      <!-- Profile Button -->
      <ion-button id="profile-button" class="btn-3d profile-btn" *ngIf="currentUser" fill="clear" aria-label="Profile">
        <div class="button-content">
          <ion-avatar class="profile-avatar">
            <img [src]="currentUser.photoURL || 'assets/default-avatar.png'" alt="Profile" />
            <div class="online-status"></div>
          </ion-avatar>
          <span class="button-ripple"></span>
        </div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-popover trigger="role-button" showBackdrop="true" side="bottom" alignment="end" class="tier-info-popover">
  <ng-template>
    <ion-content class="ion-padding">
      <div class="tier-info-container">
        <h3 class="popover-title">Your Account Tier</h3>

        <div class="tier-card" [class.active-tier]="isDevUser">
          <div class="tier-header">
            <svg viewBox="0 0 24 24" class="tier-icon">
              <path fill="currentColor"
                d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.1 14.8,9.5V11C15.4,11 16,11.6 16,12.2V15.7C16,16.4 15.4,17 14.8,17H9.2C8.6,17 8,16.4 8,15.7V12.2C8,11.6 8.6,11 9.2,11V9.5C9.2,8.1 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,9.5V11H13.5V9.5C13.5,8.7 12.8,8.2 12,8.2Z" />
            </svg>
            <h4>POWER USER Tier</h4>
            <div class="premium-tag">Premium</div>
          </div>
          <ul class="tier-features">
            <li>Cloud Sync via Firestore</li>
            <li>Cross-device data access</li>
            <li>Advanced analytics</li>
          </ul>
        </div>

        <div class="tier-card" [class.active-tier]="!isDevUser">
          <div class="tier-header">
            <svg viewBox="0 0 24 24" class="tier-icon">
              <path fill="currentColor"
                d="M12,3A4,4 0 0,0 8,7V9H6V7A6,6 0 0,1 12,1A6,6 0 0,1 18,7V9H16V7A4,4 0 0,0 12,3M19,10H5A2,2 0 0,0 3,12V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V12A2,2 0 0,0 19,10Z" />
            </svg>
            <h4>LISTENER Tier</h4>
            <div class="standard-tag">Standard</div>
          </div>
          <ul class="tier-features">
            <li>Local device storage</li>
            <li>Single device access</li>
            <li>Basic functionality</li>
          </ul>
        </div>

        <div class="data-warning">
          <svg viewBox="0 0 24 24" class="warning-icon">
            <path fill="currentColor"
              d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
          </svg>
          <p>Local storage data will be lost if you uninstall or clear app data</p>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-popover>

<ion-popover trigger="profile-button" showBackdrop="true" side="bottom" alignment="end" class="rich-popover">
  <ng-template>
    <ion-content class="ion-padding profile-popover">
      <div class="profile-header">
        <ion-avatar class="popover-avatar">
          <img [src]="currentUser.photoURL || 'assets/default-avatar.png'" />
          <div class="online-status"></div>
        </ion-avatar>
        <div class="profile-info">
          <h3>{{ currentUser.displayName || 'User' }}</h3>
          <p>{{ currentUser.email || 'Premium Member' }}</p>
        </div>
      </div>

      <!-- <ion-list lines="none" class="popover-menu">
        <ion-item button class="popover-item" (click)="openProfile()">
          <ion-icon slot="start" name="person" color="primary"></ion-icon>
          <ion-label>Profile</ion-label>
        </ion-item>
        <ion-item button class="popover-item" (click)="openSettings()">
          <ion-icon slot="start" name="settings" color="primary"></ion-icon>
          <ion-label>Settings</ion-label>
        </ion-item>
        <ion-item button class="popover-item" (click)="openSubscription()">
          <ion-icon slot="start" name="diamond" color="primary"></ion-icon>
          <ion-label>Subscription</ion-label>
        </ion-item>
      </ion-list> -->

      <ion-button expand="block" color="danger" fill="outline" class="logout-btn" (click)="logout()">
        <ion-icon slot="start" name="log-out"></ion-icon>
        Logout
      </ion-button>
    </ion-content>
  </ng-template>
</ion-popover>
<!-- <ion-header collapse="condense">
  <ion-toolbar>
    <div class="ion-text-start">
      <img src="../../assets/max.png" width="120" alt="">
      <div class="ion-text-start ion-margin-start" style="line-height: 0.3;">
        <ion-note><small>beta</small></ion-note>
      </div>
    </div>

  </ion-toolbar>
</ion-header> -->
<ion-content class="ion-padding" mode="ios" [fullscreen]="true">
  <div class="d-flex" style="margin-top: 8px;">
    <ion-chip class=" ion-margin-start" (click)=" trending=false;init();">

      All</ion-chip>
    <ion-chip class=" ion-margin-start" (click)=" trending=true;init();">
      <span class="material-symbols-outlined" style="margin-right: 4px;">
        trending_up
      </span>
      Trending</ion-chip>

  </div><br>
  <div class=" ion-margin-start">
    <ion-label class="">
      <h2>{{trending? 'Today trendings' : 'Recommented for today'}}</h2>
    </ion-label>
  </div>
  <div class="">
    @if (!homePageSongs.length) {
    <!-- Skeleton Loader UI -->
    <div class="d-flex ion-justify-content-between">
      @for (i of [1,2,3,4,5]; track i) {
      <div>
        <ion-card>
          <ion-card-header>
            <ion-thumbnail class="thum">
              <ion-skeleton-text animated style="width: 200px; height: 100px;"></ion-skeleton-text>
            </ion-thumbnail>
          </ion-card-header>
          <div class="ion-padding ion-text-center">
            <ion-label class="elli">
              <h2><ion-skeleton-text animated style="width: 80%;"></ion-skeleton-text></h2>
              <p><ion-skeleton-text animated style="width: 60%;"></ion-skeleton-text></p>
            </ion-label>
          </div>
        </ion-card>
      </div>
      }
    </div>
    } @else {
    <!-- Actual Data -->
    <div class="premium-feature" (click)="playSong(homePageSongs[0][0], 0)">
      <div class="featured-backdrop" [style.background-image]="'url(' + homePageSongs[0][0].image[2].url + ')'">
        <div class="backdrop-overlay"></div>
        <div class="vignette"></div>
      </div>

      <div class="featured-content">

        <div class="track-info">
          <h2 class="track-title" [innerHTML]="sanitizeHtml(homePageSongs[0][0].name)"></h2>
          <div class="track-meta">
            <span class="album-name" [innerHTML]="sanitizeHtml(homePageSongs[0][0].album.name)"></span>
          </div>
        </div>

        <div class="play-action">
          <div class="play-button">
            <div class="play-icon-wrapper">
              <ion-icon name="play"></ion-icon>
            </div>
            <span>Play Track</span>
          </div>
        </div>
      </div>
    </div>

    <div class="horizontal-scroll-container ion-margin-top">
      @for (song of homePageSongs[0].slice(1, 5); let i = $index; track song) {
      <div class="music-scroll-card" (click)="playSong(song, i+5)">
        <div class="card-image-wrapper">
          <img [src]="song.image[1].url" alt="Album" class="album-image">
          <div class="play-overlay">
            <ion-icon name="play" class="play-icon"></ion-icon>
          </div>
        </div>
        <div class="song-info">
          <h4 class="song-title">{{ song.name }}</h4>
        </div>
      </div>
      }
    </div>

    <div class="music-grid">
      @for (song of homePageSongs[0].slice(5, 39); let i = $index; track song) {
      <div class="music-card" (click)="playSong(song, i+1)">
        <div class="artwork-wrapper">
          <img [src]="song.image[1].url" alt="Album cover" class="album-art">
          <div class="artwork-overlay">
            <div class="play-btn">
              <ion-icon name="play" class="play-icon"></ion-icon>
            </div>
          </div>
        </div>

        <div class="song-info">
          <h3 class="song-title" [innerHTML]="sanitizeHtml(song.name)"></h3>
          <p class="artist-name" [innerHTML]="sanitizeHtml(song.album.name)"></p>
        </div>
      </div>
      }
    </div>
    }
  </div>


  <ion-modal #modal [isOpen]="isModalOpen" (ionModalDidDismiss)="closeModal()" [initialBreakpoint]="1"
    [breakpoints]="[0, 1]">
    <ng-template>
      <ion-content>

        <div class="player-view">
          <!-- Album Info Section -->
          <div class="album-info">
            <h1 class="album-title" [innerHTML]="sanitizeHtml(currentSong?.album?.name)"></h1>
            <p class="album-label" [innerHTML]="sanitizeHtml(currentSong?.label)"></p>
          </div>

          <!-- Album Art -->
          <div class="album-art-container">
            <img [src]="currentSong?.image[2]?.url" alt="Album Cover" class="album-art"
              [class.art-elevated]="isPlaying">
            <div class="art-shadow"></div>
          </div>

          <!-- Song Info -->
          <div class="song-info">
            <h2 class="song-title" [innerHTML]="sanitizeHtml(currentSong?.name)"></h2>
            <p class="song-year">{{currentSong?.year}}</p>
          </div>

          <!-- Controls -->
          <div class="player-controls">
            <!-- Top Controls -->
            <div class="player-controls-container">
              <!-- Secondary Controls -->
              <div class="secondary-controls">
                <button class="control-icon" (click)="toggleShuffle()" [class.active]="isShuffle">
                  <div class="icon-wrapper">
                    <span class="material-symbols-outlined">
                      {{ isShuffle ? 'shuffle_on' : 'shuffle' }}
                    </span>
                  </div>
                  <div class="control-ripple"></div>
                </button>

                <button class="control-icon" (click)="toggleLikeSong(currentSong)" [class.active]="isLiked">
                  <div class="icon-wrapper">
                    <span class="material-symbols-outlined">
                      {{ isLiked ? 'favorite' : 'favorite' }}
                    </span>
                  </div>
                  <div class="control-ripple"></div>
                </button>
              </div>

              <div class="progress-section">
                <div class="progress-bar-container">
                  <!-- Background Track -->
                  <div class="progress-bg-track"></div>

                  <!-- Highlight Progress -->
                  <div class="progress-highlight" [style.width.%]="duration ? (currentTime / duration) * 100 : 0">
                  </div>

                  <!-- Interactive Range -->
                  <ion-range class="premium-range" [min]="0" [max]="duration" [(ngModel)]="currentTime"
                    (ionChange)="seekSong($event)">
                  </ion-range>
                </div>

                <div class="time-display">
                  <span class="current-time">{{ formatTime(currentTime) }}</span>
                  <span class="duration">{{ formatTime(duration) }}</span>
                </div>
              </div>

            </div>

            <!-- Main Controls -->
            <div class="primary-controls">
              <button class="nav-btn" (click)="prevSong()">
                <span class="material-symbols-outlined">skip_previous</span>
              </button>

              <button class="play-btn" (click)="togglePlayPause()">
                <span class="material-symbols-outlined">
                  {{isPlaying ? "pause" : "play_arrow"}}
                </span>
              </button>

              <button class="nav-btn" (click)="nextSong()">
                <span class="material-symbols-outlined">skip_next</span>
              </button>
            </div>
          </div>

          <!-- Stream Quality -->
          <div class="stream-info">
            <ion-text>
              <p class="stream-quality">Now Streaming in: {{streamQuality}}</p>
            </ion-text>
          </div>
        </div>

        <ion-card class="ion-no-padding ion-no-margin" style="width: 100%;">
          <ion-card-header>
            <ion-label class="ion-text-center">Artists</ion-label>
          </ion-card-header>

          <ion-card-content>
            <div class="artist-container">
              <img *ngFor="let artist of currentSong?.artists?.primary" [src]="artist.image[1]?.url"
                alt="{{ artist.name }}">
            </div>

          </ion-card-content>
        </ion-card>

        @if(queue.length > 0) {
        <ion-card class="ion-no-padding ion-no-margin ion-margin-top rounded-xl shadow-md" style="width: 100%;">
          <ion-card-header class="bg-white border-b border-gray-200">
            <ion-label class="ion-text-center">Up Next</ion-label>
          </ion-card-header>

          <ion-card-content class="ion-no-padding bg-white">
            <ion-list lines="inset" class="rounded-lg">
              <ion-reorder-group [disabled]="false" (ionItemReorder)="handleReorder($event)">
                <ion-item *ngFor="let qSong of queue; let i = index;" button (click)="playSong(qSong, i)"
                  class="px-2 py-1 hover:bg-gray-100 transition-all duration-150">

                  <!-- Song Thumbnail -->
                  <ion-thumbnail slot="start" class="rounded-md overflow-hidden">
                    <img [src]="qSong.image[1]?.url" alt="Album Art">
                  </ion-thumbnail>

                  <!-- Song Info -->
                  <ion-label class="pl-2">
                    <h2 class="text-base font-medium text-gray-800 truncate">{{ qSong.name }}</h2>
                    <p class="text-sm text-gray-500 truncate">{{ qSong.album.name }} • {{ qSong.year }}</p>
                  </ion-label>

                  <!-- Drag Handle (SVG) -->
                  <ion-reorder slot="end">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                      class="text-gray-400" viewBox="0 0 16 16">
                      <path
                        d="M4 9.5a.5.5 0 0 1 .5-.5H11a.5.5 0 0 1 0 1H4.5a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5H11a.5.5 0 0 1 0 1H4.5a.5.5 0 0 1-.5-.5z" />
                    </svg>
                  </ion-reorder>

                </ion-item>
              </ion-reorder-group>
            </ion-list>
          </ion-card-content>
        </ion-card>


        }
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>

@if(currentSong){
<ion-footer class="music-player-footer">


  <ion-toolbar class="player-controls-toolbar">
    <div class="player-progress-container ion-margin-bottom">
      <ion-progress-bar [value]="currentTime / duration" color="primary" class="player-progress-bar"
        [class.player-active]="isPlaying">
      </ion-progress-bar>
      <div class="player-time-display">
        <span class="current-time">{{ formatTime(currentTime) }}</span>
        <span class="total-time">{{ formatTime(duration) }}</span>
      </div>
    </div>
    <div class="player-main-container">
      <div class="player-album-art" [class.player-album-spin]="isPlaying">
        <img [src]="currentSong?.image[1]?.url" alt="Now Playing" class="album-image">
        <div class="album-art-overlay"></div>
      </div>

      <div class="player-primary-controls">
        <button class="player-nav-button" (click)="prevSong()">
          <svg class="player-nav-icon" viewBox="0 0 24 24">
            <path fill="currentColor" d="M6 18V6h2v12H6m3.5-6L18 6v12l-8.5-6z" />
          </svg>
        </button>

        <button class="player-play-button" (click)="togglePlayPause()">
          <svg class="player-play-icon" viewBox="0 0 24 24">
            <path *ngIf="isPlaying" fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" />
            <path *ngIf="!isPlaying" fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" />
          </svg>
        </button>

        <button class="player-nav-button" (click)="nextSong()">
          <svg class="player-nav-icon" viewBox="0 0 24 24">
            <path fill="currentColor" d="M16 18h2V6h-2v12m-3.5-6L6 6v12l6.5-6z" />
          </svg>
        </button>
      </div>

      <div class="player-secondary-controls">
        <button class="player-action-button" (click)="toggleLikeSong(currentSong)">
          <svg class="player-action-icon" viewBox="0 0 24 24" [class.player-liked]="isLiked">
            <path fill="currentColor"
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
          </svg>
        </button>

        <button class="player-action-button" (click)="openModal()">
          <svg class="player-action-icon" viewBox="0 0 24 24">
            <path fill="currentColor"
              d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" />
          </svg>
        </button>
      </div>
    </div>

  </ion-toolbar>
</ion-footer>
}


<ion-modal #modal [isOpen]="isSearch" (ionModalDidDismiss)="closeModal()" [initialBreakpoint]="1"
  [breakpoints]="[0, 1]">
  <ng-template>
    <ion-content class="ion-margin-top">
      <ion-searchbar class="ion-margin-top" mode="ios" animated="true" placeholder="Search" [(ngModel)]="searchQuaery"
        (ionInput)="init()"></ion-searchbar>
      <ion-list inset="true">
        @for (song of homePageSongs[0]; let i = $index; track song) {
        <div>
          <ion-item (click)="playSong(song, i )" button lines="full">
            <ion-thumbnail slot="start">
              <img [src]="song.image[1].url" width="200" alt="">
            </ion-thumbnail>
            <ion-label class="elli">
              <h2>{{ song.name }}</h2>
              <p>{{ song.album.name }} - {{ song.year }}</p>
            </ion-label>
          </ion-item>

        </div>
        }
      </ion-list>
    </ion-content>
    @if(currentSong){
    <ion-footer class="music-player-footer">


      <ion-toolbar class="player-controls-toolbar">
        <div class="player-progress-container ion-margin-bottom">
          <ion-progress-bar [value]="currentTime / duration" color="primary" class="player-progress-bar"
            [class.player-active]="isPlaying">
          </ion-progress-bar>
          <div class="player-time-display">
            <span class="current-time">{{ formatTime(currentTime) }}</span>
            <span class="total-time">{{ formatTime(duration) }}</span>
          </div>
        </div>
        <div class="player-main-container">
          <div class="player-album-art" [class.player-album-spin]="isPlaying">
            <img [src]="currentSong?.image[1]?.url" alt="Now Playing" class="album-image">
            <div class="album-art-overlay"></div>
          </div>

          <div class="player-primary-controls">
            <button class="player-nav-button" (click)="prevSong()">
              <svg class="player-nav-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M6 18V6h2v12H6m3.5-6L18 6v12l-8.5-6z" />
              </svg>
            </button>

            <button class="player-play-button" (click)="togglePlayPause()">
              <svg class="player-play-icon" viewBox="0 0 24 24">
                <path *ngIf="isPlaying" fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" />
                <path *ngIf="!isPlaying" fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" />
              </svg>
            </button>

            <button class="player-nav-button" (click)="nextSong()">
              <svg class="player-nav-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M16 18h2V6h-2v12m-3.5-6L6 6v12l6.5-6z" />
              </svg>
            </button>
          </div>

          <div class="player-secondary-controls">
            <button class="player-action-button" (click)="toggleLikeSong(currentSong)">
              <svg class="player-action-icon" viewBox="0 0 24 24" [class.player-liked]="isLiked">
                <path fill="currentColor"
                  d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
              </svg>
            </button>

            <button class="player-action-button" (click)="openModal()">
              <svg class="player-action-icon" viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" />
              </svg>
            </button>
          </div>
        </div>

      </ion-toolbar>
    </ion-footer>
    }
  </ng-template>
</ion-modal>

<ion-modal #modal [isOpen]="isLikedSongsModal" (ionModalDidDismiss)="closeModal()" [initialBreakpoint]="1"
  [breakpoints]="[0, 1]">
  <ng-template>
    <ion-content class="liked-songs-content">
      <!-- Premium Header -->
      <div class="header-container">
        <div class="header-overlay"></div>
        <div class="header-content">
          <h1 class="header-title">Liked Songs</h1>
          <p class="song-count">You've liked {{ homePageSongs[0]?.length || 0 }} songs — your personal favorites, all in
            one place.</p>

        </div>
      </div>
      <!-- Loader -->
      <div *ngIf="likedSongLoading" class="skeleton-loader">
        @for (item of [1,2,3,4,5,6,7,8]; track $index) {
        <div class="skeleton-item">
          <div class="skeleton-number"></div>
          <div class="skeleton-art"></div>
          <div class="skeleton-details">
            <div class="skeleton-line"></div>
            <div class="skeleton-line short"></div>
          </div>
          <div class="skeleton-actions">
            <div class="skeleton-icon"></div>
            <div class="skeleton-icon"></div>
          </div>
        </div>
        }
      </div>
      <!-- Premium Song List -->
      <div class="song-list" *ngIf="!likedSongLoading">
        @for (song of homePageSongs[0]; let i = $index; track song) {
        <div class="song-item" [class.playing]="currentSong?.id === song.id" (click)="playSong(song, i)">
          <div class="song-number">{{ i + 1 }}</div>

          <div class="album-art">
            <img [src]="song.image[1]?.url" alt="Album cover" class="art-image">
            <div class="art-overlay" *ngIf="currentSong?.id === song.id">
              <svg *ngIf="isPlaying" class="play-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" />
              </svg>
              <svg *ngIf="!isPlaying && currentSong?.id === song.id" class="pause-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" />
              </svg>
            </div>
          </div>

          <div class="song-details">
            <h3 class="song-title">{{ song.name }}</h3>
            <p class="song-info">{{ song.album.name }} • {{ song.year }}</p>
          </div>

          <div class="song-actions">
            <button class="action-btn" (click)="$event.stopPropagation(); toggleLikeSong(song)">
              <svg class="heart-icon" viewBox="0 0 24 24" [class.liked]="isLiked">
                <path fill="currentColor"
                  d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" />
              </svg>
            </button>
            <button class="action-btn" (click)="$event.stopPropagation(); addToQueue(song)">
              <svg class="queue-icon" viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="M14,10H3V12H14V10M14,6H3V8H14V6M3,16H10V14H3V16M21.5,11.5L23,13L16,20L11.5,15.5L13,14L16,17L21.5,11.5Z" />
              </svg>
            </button>
          </div>
        </div>
        }
      </div>
    </ion-content>
    @if(currentSong){
    <ion-footer class="music-player-footer">


      <ion-toolbar class="player-controls-toolbar">
        <div class="player-progress-container ion-margin-bottom">
          <ion-progress-bar [value]="currentTime / duration" color="primary" class="player-progress-bar"
            [class.player-active]="isPlaying">
          </ion-progress-bar>
          <div class="player-time-display">
            <span class="current-time">{{ formatTime(currentTime) }}</span>
            <span class="total-time">{{ formatTime(duration) }}</span>
          </div>
        </div>
        <div class="player-main-container">
          <div class="player-album-art" [class.player-album-spin]="isPlaying">
            <img [src]="currentSong?.image[1]?.url" alt="Now Playing" class="album-image">
            <div class="album-art-overlay"></div>
          </div>

          <div class="player-primary-controls">
            <button class="player-nav-button" (click)="prevSong()">
              <svg class="player-nav-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M6 18V6h2v12H6m3.5-6L18 6v12l-8.5-6z" />
              </svg>
            </button>

            <button class="player-play-button" (click)="togglePlayPause()">
              <svg class="player-play-icon" viewBox="0 0 24 24">
                <path *ngIf="isPlaying" fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" />
                <path *ngIf="!isPlaying" fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" />
              </svg>
            </button>

            <button class="player-nav-button" (click)="nextSong()">
              <svg class="player-nav-icon" viewBox="0 0 24 24">
                <path fill="currentColor" d="M16 18h2V6h-2v12m-3.5-6L6 6v12l6.5-6z" />
              </svg>
            </button>
          </div>

          <div class="player-secondary-controls">
            <button class="player-action-button" (click)="toggleLikeSong(currentSong)">
              <svg class="player-action-icon" viewBox="0 0 24 24" [class.player-liked]="isLiked">
                <path fill="currentColor"
                  d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
              </svg>
            </button>

            <button class="player-action-button" (click)="openModal()">
              <svg class="player-action-icon" viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" />
              </svg>
            </button>
          </div>
        </div>

      </ion-toolbar>
    </ion-footer>
    }
  </ng-template>
</ion-modal>

<ion-modal #modal [isOpen]="isSettings" (ionModalDidDismiss)="closeModal()" [initialBreakpoint]="1"
  [breakpoints]="[0, 1]">
  <ng-template>
    <ion-header>

    </ion-header>
    <ion-content class="luxury-settings">
      <!-- Premium Header -->
      <div class="luxury-header">
        <div class="logo-container">
          <img src="../../assets/max.png" alt="Max Music" class="luxury-logo">
          <div class="version-tag">
            <span class="badge">BETA v0.1.233</span>
          </div>
        </div>
      </div>

      <!-- Luxury Settings Cards -->
      <div class="settings-cards">
        <!-- Theme Card -->
        <!-- <div class="luxury-card" [class.active]="paletteToggle">
          <div class="card-icon">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor" d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"/>
            </svg>
          </div>
          <div class="card-content">
            <h3>Dark Theme</h3>
            <p>Switch between light and dark modes</p>
          </div>
          <ion-toggle class="luxury-toggle" [checked]="paletteToggle" (ionChange)="toggleChange($event)"></ion-toggle>
        </div>
     -->
        <!-- Local Files Card -->
        <div class="luxury-card disabled">
          <div class="card-icon">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
            </svg>
          </div>
          <div class="card-content">
            <h3>Local Audio Files</h3>
            <p>Coming in next update</p>
          </div>
          <div class="coming-soon">SOON</div>
        </div>

        <!-- Quality Card -->
        <div class="luxury-card">
          <div class="card-icon">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M3 17V19H10V17H3M3 5V7H14V5H3M14 21V19H21V17H14V15H12V21H14M7 9V11H3V13H7V15H9V9H7M21 13V11H12V13H21M15 9H17V7H21V5H17V3H15V9Z" />
            </svg>
          </div>
          <div class="card-content">
            <h3>Stream Quality</h3>
            <p>Adjust audio resolution</p>
          </div>
          <ion-select class="luxury-select" [(ngModel)]="selectedQuality" interface="action-sheet"
            (ionChange)="changeQuality($event)">
            <ion-select-option *ngFor="let option of qualityOptions" [value]="option.value">{{ option.label
              }}</ion-select-option>
          </ion-select>
        </div>
      </div>

      <div class="storage-notice">
        <div class="notice-icon">
          <svg viewBox="0 0 24 24">
            <path fill="currentColor" d="M11 15H6l7-14v8h5l-7 14v-8Z" />
          </svg>
        </div>
        <div class="notice-content">
          <h4>Data Storage Notice</h4>
          <p>Your liked songs and preferences are stored locally on your device. Uninstalling the app or clearing data
            will permanently delete this information.</p>
        </div>
      </div>

      <!-- Luxury Developer Section -->
      <div class="luxury-developer">
        <div class="dev-header">
          <div class="diamond-icon">◆</div>
          <h4>Designed & Developed by</h4>
        </div>
        <div class="dev-profile">
          <div class="dev-name">KULASEKARAN KRISHNARAJ</div>
          <div class="dev-title">Associate Software Engineer</div>
        </div>
        <div class="social-links">
          <a href="mailto:itzkulasekaran@gmail.com" class="social-btn email">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M22 6C22 4.9 21.1 4 20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6M20 6L12 11L4 6H20M20 18H4V8L12 13L20 8V18Z" />
            </svg>
          </a>
          <a href="https://github.com/Kulasekaranguna" target="_blank" class="social-btn github">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
            </svg>
          </a>
          <a href="https://instagram.com/itzguna__" target="_blank" class="social-btn instagram">
            <svg viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z" />
            </svg>
          </a>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>